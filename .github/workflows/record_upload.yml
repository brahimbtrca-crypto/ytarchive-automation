name: Record and Upload Live Streams

on:
  workflow_dispatch:  # run manually when you want

jobs:
  record:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.21

      - name: Install ytarchive
        run: go install github.com/ytarchive/ytarchive/cmd/ytarchive@latest

      - name: Prepare recordings folder
        run: mkdir -p recordings

      - name: Record live streams
        run: |
          while IFS= read -r url; do
            echo "Starting recording: $url"
            # This will wait for the live stream to start and record until it ends
            $GOPATH/bin/ytarchive -o recordings "$url"
            echo "Finished recording: $url"
          done < urls.txt

      - name: Upload recordings to Google Drive
        run: |
          python upload_to_drive.py
        env:
          GOOGLE_TOKEN_JSON: ${{ secrets.GOOGLE_TOKEN_JSON }}
